<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../../ux_1473630887_6370625/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common.css" />
		<link rel="stylesheet" type="text/css" href="changePwd.css" />
		<title>修改密码</title>
	</head>

	<body>
		<header class="mui-bar">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left pui-a-left"></a>
			<h1 class="mui-title">修改密码</h1>
			<a id="save" class="mui-pull-right pui-a-right">保存</a>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view">
				<li class="mui-table-view-input mui-input-row">
					<label>旧密码</label>
					<input id="oldPwd" type="text" class="mui-input-clear pui-account" placeholder="请输入旧密码">
				</li>
			</ul>
			<ul class="mui-table-view mt15">
				<li class="mui-table-view-input mui-input-row">
					<label>新密码</label>
					<input id="newPwd" type="text" class="mui-input-clear pui-account" placeholder="请输入大于或等于6位的新密码">
				</li>
				<li class="mui-table-view-input mui-input-row">
					<label>确认新密码</label>
					<input id="sureNewPwd" type="text" class="mui-input-clear pui-account" placeholder="请确认设置的新密码">
				</li>
			</ul>
		</div>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			(function($, doc) {
				$.init({});
				var openid = localStorage.getItem("ptt_openid");
				var access_token = localStorage.getItem("access_token");
				doc.getElementById("save").addEventListener("tap", function() {
					var oldPwd = document.getElementById("oldPwd").value;
					var newPwd = document.getElementById("newPwd").value;
					var sureNewPwd = document.getElementById("sureNewPwd").value;
					if(newPwd === sureNewPwd&&newPwd.length>=6) {
						mui.ajax(req_url + '/api/v1/profile/password?access_token=' + access_token + '&openid=' + openid, {
							dataType: 'json', //服务器返回json格式数据
							type: 'POST', //HTTP请求类型
							timeout: 10000, //超时时间设置为10秒；
							data: {
								'oldpwd': oldPwd,
								'newpwd': newPwd
							},
							headers: {
								'Content-Type': 'application/x-www-form-urlencoded'
							},
							success: function(data) {
								if(data.code == 20001) {
									$.alert("修改成功", function() {
										$.back();
									}, "提示", "确定");
								}else{
									$.alert("修改失败", function() {
//										oldPwd.focus();
									}, "提示", "确定");
								}
							},
							error: function(xhr, type, errorThrown) {
								//异常处理；
								console.log(type);
							}
						});
					}else {
						$.alert("两次输入的密码不一致或者密码未达到要求", function() {
							newPwd.value = "";
							sureNewPwd.value="";
//							newPwd.focus();
						}, "提示", "确定");
					}
				})
			}(mui, document));
		</script>
	</body>

</html>